<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div class="container">
    <header>
      <div class="header-brand">
        <img src="icons/icon32.png" alt="Limitr" class="header-icon">
        <h1>Limitr</h1>
      </div>
      <div class="header-controls">
        <div class="status" id="status">
          <span class="status-dot"></span>
          <span class="status-text">Off</span>
        </div>
        <label class="toggle">
          <input type="checkbox" id="enabled">
          <span class="slider"></span>
        </label>
      </div>
    </header>

    <div class="mode-row">
      <span class="mode-label crt-label" id="crtLabel" title="CRT visual effect: scanlines, vignette, color shift">CRT</span>
      <label class="toggle small">
        <input type="checkbox" id="crtToggle">
        <span class="slider"></span>
      </label>
      <span class="mode-divider">|</span>
      <span class="mode-label exclusive-mode" id="mixerModeLabel" title="Exclusive Mode: AI Noise Suppression, Limiter, AGC + Multi-tab mixing. No fullscreen support.">Exclusive</span>
      <label class="toggle small">
        <input type="checkbox" id="mixerModeToggle">
        <span class="slider"></span>
      </label>
      <span class="mode-divider">|</span>
      <span class="mode-label" id="modeLabel">Simple</span>
      <label class="toggle small">
        <input type="checkbox" id="modeToggle">
        <span class="slider"></span>
      </label>
    </div>

    <div class="mode-info" id="modeInfo">
      <span class="mode-badge regular" id="modeBadge">Regular Mode</span>
      <span class="mode-note" id="modeNote">Fullscreen compatible</span>
    </div>

    <div class="meters-row">
      <div class="meter-container meter-flex">
        <label>Gain Reduction</label>
        <div class="meter">
          <div class="meter-fill" id="reductionMeter"></div>
          <span class="meter-value" id="reductionValue">0 dB</span>
        </div>
      </div>
      <div class="meter-container meter-lufs">
        <label>LUFS</label>
        <div class="meter lufs-meter">
          <div class="meter-fill lufs-fill" id="lufsMeter"></div>
          <span class="meter-value" id="lufsValue">--</span>
        </div>
      </div>
    </div>

    <!-- Presets (generated dynamically from popup.js presetUI) -->
    <div class="presets-section">
      <div class="presets-grid" id="presetsGrid"></div>
    </div>

    <!-- Simple Mode Controls -->
    <div id="simpleControls" class="controls">
      <div class="control-group">
        <div class="control-header">
          <label for="outputGainSimple">Output Volume</label>
          <span class="value" id="outputGainSimpleValue">0 dB</span>
        </div>
        <input type="range" id="outputGainSimple" min="-24" max="24" value="0" step="1">
      </div>

      <!-- AI Noise Suppression (Exclusive mode only) -->
      <div class="simple-anc-row" id="simpleAncRow">
        <div class="control-header">
          <label>AI Noise Suppression</label>
          <label class="toggle small">
            <input type="checkbox" id="noiseSuppressionToggleSimple">
            <span class="slider"></span>
          </label>
          <span class="noise-suppression-label" id="noiseSuppressionLabelSimple">Off</span>
        </div>
        <div class="control-note">RNNoise AI — Exclusive mode only</div>
      </div>

      <!-- Video Transcriber (Exclusive mode only) -->
      <div class="simple-anc-row" id="simpleTranscriberRow">
        <div class="control-header">
          <label>Video Transcriber</label>
          <label class="toggle small">
            <input type="checkbox" id="transcriberToggleSimple">
            <span class="slider"></span>
          </label>
          <span class="transcriber-label" id="transcriberLabelSimple">Off</span>
        </div>
        <div class="control-note">Whisper AI captions — Exclusive mode only</div>
        <div class="transcriber-output" id="transcriberOutputSimple" style="display: none;">
          <div class="transcriber-text" id="transcriberTextSimple"></div>
        </div>
      </div>
    </div>

    <!-- Advanced Mode Controls -->
    <div id="advancedControls" class="controls" style="display: none;">
      <!-- Exclusive Mode Features (AI Noise Suppression, Auto-Gain) -->
      <div class="exclusive-features-group collapsible-section" id="exclusiveFeaturesGroup">
        <div class="exclusive-features-header section-header">
          <span>Exclusive Features</span>
          <span class="exclusive-badge" id="exclusiveBadge">Requires Exclusive Mode</span>
        </div>

        <div class="section-body">
          <!-- AI Noise Suppression -->
          <div class="control-section-label noise-suppression-header">
            <span>AI Noise Suppression</span>
            <label class="toggle small">
              <input type="checkbox" id="noiseSuppressionToggle">
              <span class="slider"></span>
            </label>
            <span class="noise-suppression-label" id="noiseSuppressionLabel">Off</span>
          </div>
          <div class="control-note" id="noiseSuppressionNote">
            RNNoise AI removes background noise (keyboard, fan, etc.)
          </div>

          <!-- Auto-Gain (AGC) -->
          <div class="control-section-label auto-gain-header">
            <span>Auto-Gain (AGC)</span>
            <label class="toggle small">
              <input type="checkbox" id="autoGainToggle">
              <span class="slider"></span>
            </label>
            <span class="auto-gain-label" id="autoGainLabel">Off</span>
          </div>
          <div class="control-group">
            <div class="control-header">
              <label for="autoGainTarget">Target Level</label>
              <span class="value" id="autoGainTargetValue">-16 dB</span>
            </div>
            <input type="range" id="autoGainTarget" min="-30" max="-6" value="-16" step="1">
          </div>
          <div class="control-group">
            <div class="control-header">
              <label for="autoGainSpeed">AGC Speed</label>
            </div>
            <select id="autoGainSpeed" class="dropdown">
              <option value="slow">Slow (Smooth, gentle)</option>
              <option value="normal" selected>Normal (Balanced)</option>
              <option value="fast">Fast (Anti-scream)</option>
            </select>
          </div>

          <!-- Video Transcriber (Moonshine) -->
          <div class="control-section-label transcriber-header">
            <span>Video Transcriber</span>
            <label class="toggle small">
              <input type="checkbox" id="transcriberToggle">
              <span class="slider"></span>
            </label>
            <span class="transcriber-label" id="transcriberLabel">Off</span>
          </div>
          <div class="control-note" id="transcriberNote">
            Moonshine AI — live captions from tab audio
          </div>
          <div class="transcriber-output" id="transcriberOutput" style="display: none;">
            <div class="transcriber-text" id="transcriberText"></div>
          </div>

          <!-- Noise Gate -->
          <div class="control-section-label noise-gate-header">
            <span>Noise Gate</span>
            <label class="toggle small">
              <input type="checkbox" id="gateToggle">
              <span class="slider"></span>
            </label>
            <span class="noise-gate-label" id="gateLabel">Off</span>
          </div>
          <div class="control-note">
            Silences hiss/noise in quiet sections
          </div>
          <div class="control-group">
            <div class="control-header">
              <label for="gateThreshold">Threshold</label>
              <span class="value" id="gateThresholdValue">-50 dB</span>
            </div>
            <input type="range" id="gateThreshold" min="-80" max="-20" value="-50" step="1">
          </div>
          <div class="control-group">
            <div class="control-header">
              <label for="gateHold">Hold</label>
              <span class="value" id="gateHoldValue">100 ms</span>
            </div>
            <input type="range" id="gateHold" min="0" max="500" value="100" step="10">
          </div>
          <div class="control-group">
            <div class="control-header">
              <label for="gateRelease">Release</label>
              <span class="value" id="gateReleaseValue">200 ms</span>
            </div>
            <input type="range" id="gateRelease" min="50" max="1000" value="200" step="10">
          </div>

          <!-- Audio Ducking -->
          <div class="control-section-label ducking-header">
            <span>Audio Ducking</span>
            <label class="toggle small">
              <input type="checkbox" id="duckingToggle">
              <span class="slider"></span>
            </label>
            <span class="ducking-label" id="duckingLabel">Off</span>
          </div>
          <div class="control-note">
            Lowers music/SFX when speech is detected
          </div>
          <div class="control-group">
            <div class="control-header">
              <label for="duckingThreshold">Speech Threshold</label>
              <span class="value" id="duckingThresholdValue">-35 dB</span>
            </div>
            <input type="range" id="duckingThreshold" min="-60" max="-10" value="-35" step="1">
          </div>
          <div class="control-group">
            <div class="control-header">
              <label for="duckingAmount">Duck Amount</label>
              <span class="value" id="duckingAmountValue">-12 dB</span>
            </div>
            <input type="range" id="duckingAmount" min="-24" max="0" value="-12" step="1">
          </div>
          <div class="control-group">
            <div class="control-header">
              <label for="duckingRelease">Release</label>
              <span class="value" id="duckingReleaseValue">300 ms</span>
            </div>
            <input type="range" id="duckingRelease" min="50" max="1000" value="300" step="10">
          </div>
        </div>
      </div>

      <!-- Limiter (works in both Regular and Exclusive modes) -->
      <div class="collapsible-section" id="limiterSection">
        <div class="control-section-label limiter-header section-header">
          <span>Limiter</span>
          <label class="toggle small">
            <input type="checkbox" id="limiterToggle" checked>
            <span class="slider"></span>
          </label>
          <span class="limiter-label active" id="limiterLabel">On</span>
        </div>
        <div class="section-body">
          <div class="control-group">
            <div class="control-header">
              <label for="limiterThreshold">Ceiling</label>
              <span class="value" id="limiterThresholdValue">-1 dB</span>
            </div>
            <input type="range" id="limiterThreshold" min="-30" max="0" value="-1" step="0.5">
          </div>
        </div>
      </div>

      <div class="collapsible-section" id="compressorSection">
        <div class="control-section-label compressor-header section-header">
          <span>Compressor</span>
          <label class="toggle small">
            <input type="checkbox" id="compressorToggle" checked>
            <span class="slider"></span>
          </label>
          <span class="compressor-label active" id="compressorLabel">On</span>
        </div>
        <div class="section-body">
          <div class="control-group">
            <div class="control-header">
              <label for="threshold">Threshold</label>
              <span class="value" id="thresholdValue">-24 dB</span>
            </div>
            <input type="range" id="threshold" min="-60" max="0" value="-24" step="1">
          </div>

          <div class="control-group">
            <div class="control-header">
              <label for="ratio">Ratio</label>
              <span class="value" id="ratioValue">8:1</span>
            </div>
            <input type="range" id="ratio" min="1" max="20" value="8" step="0.5">
          </div>

          <div class="control-group">
            <div class="control-header">
              <label for="knee">Knee</label>
              <span class="value" id="kneeValue">12 dB</span>
            </div>
            <input type="range" id="knee" min="0" max="40" value="12" step="1">
          </div>

          <div class="control-group">
            <div class="control-header">
              <label for="attack">Attack</label>
              <span class="value" id="attackValue">5 ms</span>
            </div>
            <input type="range" id="attack" min="0" max="100" value="5" step="1">
          </div>

          <div class="control-group">
            <div class="control-header">
              <label for="release">Release</label>
              <span class="value" id="releaseValue">100 ms</span>
            </div>
            <input type="range" id="release" min="10" max="1000" value="100" step="10">
          </div>
        </div>
      </div>

      <div class="collapsible-section" id="gainSection">
        <div class="control-section-label gain-header section-header">
          <span>Gain</span>
          <label class="toggle small">
            <input type="checkbox" id="gainToggle" checked>
            <span class="slider"></span>
          </label>
          <span class="gain-label active" id="gainLabel">On</span>
        </div>
        <div class="section-body">
          <div class="control-group">
            <div class="control-header">
              <label for="makeupGain">Makeup Gain</label>
              <span class="value" id="makeupGainValue">0 dB</span>
            </div>
            <input type="range" id="makeupGain" min="0" max="24" value="0" step="1">
          </div>

        </div>
      </div>

      <!-- Output Volume (always visible) -->
      <div class="control-group output-volume-group">
        <div class="control-header">
          <label for="outputGain">Output Volume</label>
          <span class="value" id="outputGainValue">0 dB</span>
        </div>
        <input type="range" id="outputGain" min="-24" max="24" value="0" step="1">
      </div>

      <div class="collapsible-section" id="effectsSection">
        <div class="control-section-label effects-header section-header">
          <span>Effects</span>
          <label class="toggle small">
            <input type="checkbox" id="effectsToggle">
            <span class="slider"></span>
          </label>
          <span class="effects-label" id="effectsLabel">Off</span>
        </div>
        <div class="section-body">
          <div class="control-group">
            <div class="control-header">
              <label for="noiseLevel">Noise Amount</label>
              <span class="value" id="noiseLevelValue">Off</span>
            </div>
            <input type="range" id="noiseLevel" min="0" max="0.3" value="0" step="0.01">
          </div>

          <div class="control-group">
            <div class="control-header">
              <label for="noiseType">Noise Type</label>
            </div>
            <select id="noiseType" class="dropdown">
              <option value="brown">Brown (Cozy rumble)</option>
              <option value="pink">Pink (Rain/CRT hum)</option>
              <option value="white">White (Harsh static)</option>
            </select>
          </div>
        </div>
      </div>

      <!-- Filters Section (Bass/Treble Cut) -->
      <div class="collapsible-section" id="filtersSection">
        <div class="control-section-label filters-header section-header">
          <span>Filters</span>
          <label class="toggle small">
            <input type="checkbox" id="filtersToggle">
            <span class="slider"></span>
          </label>
          <span class="filters-label" id="filtersLabel">Off</span>
        </div>
        <div class="section-body">
          <div class="control-group">
            <div class="control-header">
              <label for="bassCutFreq">Bass Cut (Highpass)</label>
              <span class="value" id="bassCutFreqValue">Off</span>
            </div>
            <input type="range" id="bassCutFreq" min="0" max="400" value="0" step="10">
          </div>

          <div class="control-group">
            <div class="control-header">
              <label for="trebleCutFreq">Treble Cut (Lowpass)</label>
              <span class="value" id="trebleCutFreqValue">Off</span>
            </div>
            <input type="range" id="trebleCutFreq" min="4000" max="22050" value="22050" step="100">
          </div>
        </div>
      </div>

      <!-- 5-Band Parametric EQ Section -->
      <div class="collapsible-section collapsed" id="eqSection">
        <div class="control-section-label eq-header section-header">
          <span>5-Band EQ</span>
          <label class="toggle small">
            <input type="checkbox" id="eqToggle">
            <span class="slider"></span>
          </label>
          <span class="eq-label" id="eqLabel">Off</span>
        </div>

        <div class="section-body" id="eqControls">
        <!-- EQ Canvas Visualization -->
        <div class="eq-canvas-container">
          <canvas id="eqCanvas" width="268" height="100"></canvas>
          <div class="eq-legend">
            <span class="eq-legend-item band1">1</span>
            <span class="eq-legend-item band2">2</span>
            <span class="eq-legend-item band3">3</span>
            <span class="eq-legend-item band4">4</span>
            <span class="eq-legend-item band5">5</span>
          </div>
        </div>

        <!-- EQ Band 1 -->
        <div class="eq-band">
          <div class="eq-band-header">
            <span class="eq-band-label band1">Band 1</span>
            <select id="eq1Type" class="dropdown-small">
              <option value="highpass">Highpass</option>
              <option value="lowshelf">Low Shelf</option>
              <option value="peaking">Bell</option>
            </select>
          </div>
          <div class="eq-band-controls">
            <div class="eq-control">
              <label>Freq</label>
              <input type="range" id="eq1Freq" min="20" max="500" value="80" step="1">
              <span class="value" id="eq1FreqValue">80 Hz</span>
            </div>
            <div class="eq-control">
              <label>Gain</label>
              <input type="range" id="eq1Gain" min="-12" max="12" value="0" step="1">
              <span class="value" id="eq1GainValue">0 dB</span>
            </div>
          </div>
        </div>

        <!-- EQ Band 2 -->
        <div class="eq-band">
          <div class="eq-band-header">
            <span class="eq-band-label band2">Band 2</span>
            <select id="eq2Type" class="dropdown-small">
              <option value="lowshelf">Low Shelf</option>
              <option value="peaking" selected>Bell</option>
              <option value="notch">Notch</option>
            </select>
          </div>
          <div class="eq-band-controls">
            <div class="eq-control">
              <label>Freq</label>
              <input type="range" id="eq2Freq" min="100" max="1000" value="250" step="5">
              <span class="value" id="eq2FreqValue">250 Hz</span>
            </div>
            <div class="eq-control">
              <label>Gain</label>
              <input type="range" id="eq2Gain" min="-12" max="12" value="0" step="1">
              <span class="value" id="eq2GainValue">0 dB</span>
            </div>
          </div>
        </div>

        <!-- EQ Band 3 -->
        <div class="eq-band">
          <div class="eq-band-header">
            <span class="eq-band-label band3">Band 3</span>
            <select id="eq3Type" class="dropdown-small">
              <option value="peaking" selected>Bell</option>
              <option value="notch">Notch</option>
            </select>
          </div>
          <div class="eq-band-controls">
            <div class="eq-control">
              <label>Freq</label>
              <input type="range" id="eq3Freq" min="500" max="4000" value="1000" step="10">
              <span class="value" id="eq3FreqValue">1.0k</span>
            </div>
            <div class="eq-control">
              <label>Gain</label>
              <input type="range" id="eq3Gain" min="-12" max="12" value="0" step="1">
              <span class="value" id="eq3GainValue">0 dB</span>
            </div>
          </div>
        </div>

        <!-- EQ Band 4 -->
        <div class="eq-band">
          <div class="eq-band-header">
            <span class="eq-band-label band4">Band 4</span>
            <select id="eq4Type" class="dropdown-small">
              <option value="peaking" selected>Bell</option>
              <option value="highshelf">High Shelf</option>
              <option value="notch">Notch</option>
            </select>
          </div>
          <div class="eq-band-controls">
            <div class="eq-control">
              <label>Freq</label>
              <input type="range" id="eq4Freq" min="2000" max="10000" value="4000" step="50">
              <span class="value" id="eq4FreqValue">4.0k</span>
            </div>
            <div class="eq-control">
              <label>Gain</label>
              <input type="range" id="eq4Gain" min="-12" max="12" value="0" step="1">
              <span class="value" id="eq4GainValue">0 dB</span>
            </div>
          </div>
        </div>

        <!-- EQ Band 5 -->
        <div class="eq-band">
          <div class="eq-band-header">
            <span class="eq-band-label band5">Band 5</span>
            <select id="eq5Type" class="dropdown-small">
              <option value="highshelf" selected>High Shelf</option>
              <option value="peaking">Bell</option>
              <option value="lowpass">Lowpass</option>
            </select>
          </div>
          <div class="eq-band-controls">
            <div class="eq-control">
              <label>Freq</label>
              <input type="range" id="eq5Freq" min="5000" max="20000" value="12000" step="100">
              <span class="value" id="eq5FreqValue">12.0k</span>
            </div>
            <div class="eq-control">
              <label>Gain</label>
              <input type="range" id="eq5Gain" min="-12" max="12" value="0" step="1">
              <span class="value" id="eq5GainValue">0 dB</span>
            </div>
          </div>
        </div>
      </div>
      </div>

      <!-- Multiband Compressor Section -->
      <div class="collapsible-section collapsed" id="multibandSection">
        <div class="control-section-label multiband-header section-header">
          <span>Multiband Compressor</span>
          <label class="toggle small">
            <input type="checkbox" id="multibandToggle">
            <span class="slider"></span>
          </label>
          <span class="multiband-label" id="multibandLabel">Off</span>
        </div>

        <div class="section-body" id="multibandControls">
        <!-- Crossover Frequencies (2 crossovers for 3 bands) -->
        <div class="multiband-crossovers">
          <div class="control-group half">
            <div class="control-header">
              <label for="crossover1">Sub/Mid</label>
              <span class="value" id="crossover1Value">200 Hz</span>
            </div>
            <input type="range" id="crossover1" min="80" max="500" value="200" step="10">
          </div>
          <div class="control-group half">
            <div class="control-header">
              <label for="crossover2">Mid/High</label>
              <span class="value" id="crossover2Value">3.0k Hz</span>
            </div>
            <input type="range" id="crossover2" min="1000" max="8000" value="3000" step="100">
          </div>
        </div>

        <!-- Per-Band Thresholds (3 bands) -->
        <div class="multiband-thresholds">
          <div class="control-group third">
            <div class="control-header">
              <label for="subThreshold" class="band-label sub">Sub</label>
              <span class="value" id="subThresholdValue">-20 dB</span>
            </div>
            <input type="range" id="subThreshold" min="-60" max="0" value="-20" step="1">
          </div>
          <div class="control-group third">
            <div class="control-header">
              <label for="midThreshold" class="band-label mid">Mid</label>
              <span class="value" id="midThresholdValue">-24 dB</span>
            </div>
            <input type="range" id="midThreshold" min="-60" max="0" value="-24" step="1">
          </div>
          <div class="control-group third">
            <div class="control-header">
              <label for="highThreshold" class="band-label high">High</label>
              <span class="value" id="highThresholdValue">-24 dB</span>
            </div>
            <input type="range" id="highThreshold" min="-60" max="0" value="-24" step="1">
          </div>
        </div>

        <!-- Per-Band Gains (3 bands) -->
        <div class="multiband-gains">
          <div class="control-group third">
            <div class="control-header">
              <label for="subGain" class="band-label sub">Sub</label>
              <span class="value" id="subGainValue">0 dB</span>
            </div>
            <input type="range" id="subGain" min="-12" max="12" value="0" step="1">
          </div>
          <div class="control-group third">
            <div class="control-header">
              <label for="midGain" class="band-label mid">Mid</label>
              <span class="value" id="midGainValue">0 dB</span>
            </div>
            <input type="range" id="midGain" min="-12" max="12" value="0" step="1">
          </div>
          <div class="control-group third">
            <div class="control-header">
              <label for="highGain" class="band-label high">High</label>
              <span class="value" id="highGainValue">0 dB</span>
            </div>
            <input type="range" id="highGain" min="-12" max="12" value="0" step="1">
          </div>
        </div>
      </div>
      </div>
    </div>

    <!-- Other Tabs Mixer -->
    <div class="mixer-section">
      <button class="mixer-toggle" id="mixerToggle">
        <span class="mixer-toggle-icon">&#9658;</span>
        <span>Other Tabs with Audio</span>
        <span class="media-count" id="mediaCount">0</span>
      </button>
      <div class="mixer-panel" id="mixerPanel" style="display: none;">
        <div class="mixer-list" id="mixerList">
          <div class="mixer-empty">No tabs playing audio</div>
        </div>
      </div>
    </div>

    <footer>
      <span class="footer-text">Limitr - Ozan Karaali</span>
    </footer>
  </div>

  <script src="popup.js"></script>
</body>
</html>
